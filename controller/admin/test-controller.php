<?php
class TestController extends BaseController {
    /**
     * Setup the base for creating template responses
     */
    public function __construct() {
        // Pass in the base for all the views
        parent::__construct();

        // Tell what is the base for all login
        $this->view_base = 'test/';
    }

    /**
     * List Accounts
     *
     *
     * @return TemplateResponse
     */
    protected function index() {
        $account = new Account();
        $account->transferToGSR(1007);

        return new HtmlResponse( 'heh' );
    }

    /**
     * Login
     *
     * @return bool
     */
//    protected function get_logged_in_user() {
//        if ( defined('CLI') && true == CLI ) {
//            $this->user = new User();
//            return true;
//        }
//
//        return false;
//    }

    protected function route53_replace() {

        $replace_search_1 = '199.79.48.137';
        $replace_search_2 = '199.79.48.138';

        if ( $this->verified() ) {

            $domain_list = explode("\n", trim( $_POST['domains'] ) );

            library('r53');
            $r53 = new Route53( Config::key('aws_iam-access-key'), Config::key('aws_iam-secret-key') );

            $marker = null;
			$account = new Account();
			
            foreach ($domain_list as $domain) {
				$account = new Account();
				$account = $account->prepare( 'SELECT *, `website_id` AS id FROM `websites` WHERE `domain` LIKE :domain', 'i', array( ':domain' => trim( '%' . $domain ) ) )->get_row( PDO::FETCH_INTO, $account );
				
				if ( !$account->id )
					continue;
				
				$zone_id = $account->get_settings( 'r53-zone-id' );
				$records_result = $r53->listResourceRecordSets( $zone_id  );
				$dns_changes = array();
				
				foreach ( $records_result['ResourceRecordSets'] as $record ) {
					$changed = false;
					foreach ( $record['ResourceRecords'] as &$record_value ) {
						if ( strpos( $record_value, $replace_search_1 ) !== false ) {
							$record_value = str_replace( $replace_search_1, $_POST['replace-1'], $record_value ) ;
							$changed = true;
						} else if ( strpos( $record_value, $replace_search_2 ) !== false ) {
							$record_value = str_replace( $replace_search_2, $_POST['replace-2'], $record_value ) ;
							$changed = true;
						}
					}
					
					if ( $changed ) {
						$dns_changes[] = $r53->prepareChange( 'UPSERT', $record['Name'], $record['Type'], $record['TTL'], $record['ResourceRecords']  );

						echo "Update for {$domain}: " . json_encode( array( 'UPSERT', $record['Name'], $record['Type'], $record['TTL'], $record['ResourceRecords']  ) ) . "<br />";
					}
					
				}
				
				if ( !empty( $dns_changes ) ) {
					echo "...running all from {$domain}...";
					$change_result = $r53->changeResourceRecordSets( $zone_id, $dns_changes, 'gsr/route53-replace ' . date('Y-m-d H:i:s') );
					echo json_encode( $change_result ) . "<br /><hr />";
				} else {
					echo "No matching records found for {$domain}<br /><hr />";
				}
            }
			
            die('Finished!');

        }

        return $this->get_template_response( 'route53-replace' )->set( compact( 'replace_search_1', 'replace_search_2' ) );
    }

    /**
     * Recompile All LESS
     * @return HtmlResponse
     */
    protected function recompile_all_less() {
        set_time_limit(3600);

        // Get account
        $unlocked = new Account();
        $unlocked->get( Account::TEMPLATE_UNLOCKED );
        $unlocked_less = $unlocked->get_settings('less');

        library('lessc.inc');

        $account = new Account();
        $less_accounts = $account->get_less_sites();

        /**
         * @var Account $less_account
         * @var string $unlocked_less
         */
        foreach ( $less_accounts as $less_account ) {
            if ( $less_account->id == Account::TEMPLATE_UNLOCKED )
                continue;

            echo "Compiling LESS for {$less_account->website_id} {$less_account->title}...<br>\n";
            flush();

            $less = new lessc;
            $less->setFormatter("compressed");

            $site_less = $less_account->get_settings('less');

            $less_account->set_settings( array(
                'css' => $less->compile( $unlocked_less . $site_less )
            ));

            unset( $less );
            unset( $site_less );
            unset( $less_account );
            gc_collect_cycles();
        }

        return new HtmlResponse( 'All LESS sites Recompiled' );
    }

    /**
     * Reorganize Categories ALL
     *
     *
     * @return HtmlResponse
     */
    protected function reorganize_categories_all() {
        $account = new Account();
        $accounts = $account->list_all( array(' AND a.status=1 ', '', '', 10000 ) );
        $account_category = new AccountCategory();
        $category = new Category();

        foreach ( $accounts as $a ) {
            echo "#{$a->id}...<br>\n";
            flush();
            $account_category->reorganize_categories( $a->website_id, $category );
        }

        return new HtmlResponse( 'Finished' );
    }

    protected function route53_spf() {

        library('r53');
        $r53 = new Route53( Config::key('aws_iam-access-key'), Config::key('aws_iam-secret-key') );

        $marker = null;
        do {
            $response = $r53->listHostedZones( $marker, 100 );
            $hosted_zones = $response['HostedZone'];
            $marker = $response['NextMarker'];

            foreach ( $hosted_zones as $zone ) {

                $zone_id = $zone['Id'];
                $records_result = $r53->listResourceRecordSets( $zone_id  );
                $dns_changes = array();
                $mail_record_in_our_servers = false;

                echo $zone['Name'].'<br>';

                foreach ( $records_result['ResourceRecordSets'] as $record ) {

                    if ( $record['Type'] == 'TXT' ) {
                        foreach( $record['ResourceRecords'] as $rr_key => $rr_value ) {
                            if ( stripos($rr_value, 'spf') !== FALSE && ( stripos( $rr_value, '162.218.139.218' ) !== FALSE ||stripos( $rr_value, '162.218.139.219' ) !== FALSE ) ) {
                                // echo $record['ResourceRecords'][$rr_key] . "<br>" . '"v=spf1 a mx ip4:199.79.48.137 ip4:208.53.48.135 ip4:199.79.48.25 ip4:162.218.139.218 ip4:162.218.139.219 ~all"<br>';
                                $record['ResourceRecords'][$rr_key] = '"v=spf1 a mx ip4:199.79.48.137 ip4:208.53.48.135 ip4:199.79.48.25 ip4:162.218.139.218 ip4:162.218.139.219 ~all"';
                                $dns_changes[] = $r53->prepareChange( 'UPSERT', $record['Name'], $record['Type'], $record['TTL'], $record['ResourceRecords']  );
                            }
                        }
                    }

                    if ( stripos( $record['Name'], 'mail.' ) === 0 ) {
                        $mail_record_values = implode(',', $record['ResourceRecords']);
                        $mail_record_in_our_servers =
                            strpos( $mail_record_values, '199.79.48.137' ) !== FALSE ||
                            strpos( $mail_record_values, '208.53.48.135' ) !== FALSE ||
                            strpos( $mail_record_values, '199.79.48.25' ) !== FALSE ||
                            strpos( $mail_record_values, '162.218.139.218' ) !== FALSE ||
                            strpos( $mail_record_values, '162.218.139.219' ) !== FALSE;
                    }
                }

                if ( $mail_record_in_our_servers ) {
                    if ( !empty( $dns_changes ) ) {
                        echo "Value for mail.[domain]: {$mail_record_values}<br>\n";
                        echo "Update TXT SPF Record required running " . count($dns_changes) . " changes from {$zone['Name']}...";
                        $change_result = array(); // $r53->changeResourceRecordSets( $zone_id, $dns_changes, 'gsr/route53-spf-update ' . date('Y-m-d H:i:s') );
                        echo json_encode( $change_result ) . "<hr />\n";
                    } else {
                        echo "No matching records found for {$zone['Name']}<hr />\n";
                    }
                } else {
                    echo "mail.{$zone['Name']} record NOT in our servers - {$mail_record_values}<br><hr>\n";
                }
                flush();
            }

        } while ( $marker != NULL );

        die('Finished!');

    }

    public function butler() {
        $butler = new ButlerFeedGateway();
        $butler->run();
    }

    public function fix_slug() {
        $product_ids = array(106,107,190,61,165,166,238,249,42804,262,263,327,328,413,460,44827,477,478,480,482,483,485,486,488,527,528,529,530,596,600,601,623,633,634,748,791,804,813,814,897,902,914,932,980,1005,1006,1067,1101,1105,1226,1231,1237,1243,1244,1274,1281,1358,1360,1403,1589,1593,39051,1730,45308,1894,1898,1900,1902,1903,1904,1914,1923,2045,50286,2047,2052,2056,2085,2110,2118,2119,2184,2185,2186,2193,2195,2196,2878,3628,19742,45404,45306,22005,39046,39047,50371,17542,21994,16475,39049,17553,19337,19339,24833,40898,21396,6866,16422,16731,15569,21916,15946,16711,23832,13673,13519,21998,15935,19745,17544,16340,16730,25097,19882,38377,17543,13675,23808,23809,23810,55995,13461,210081,13487,212136,212137,13601,13669,14240,16972,15512,15517,15518,16240,16578,15675,16089,15689,15693,15798,15799,15815,15830,15847,15860,16577,15881,15890,15920,15921,15944,15976,15978,15979,16078,16081,16090,16091,16094,16099,16100,16104,16333,16144,16188,16189,16194,16201,16241,16287,16299,16367,16403,16413,16426,16508,16525,16535,16541,16564,16581,16584,16592,16612,16619,16622,16705,16656,16657,16672,16673,16717,17094,16835,16963,16966,17093,17114,17127,17328,17349,17416,17482,17484,17485,17486,17568,18307,18309,18400,18422,18423,18458,18460,40055,40057,229282,18598,18608,18613,18614,18615,18616,18622,18633,229296,229274,18651,18669,18673,18674,18676,18683,40053,18982,19164,19249,19254,19302,19312,19344,19345,19426,19559,19602,19603,40056,24701,24727,24835,24728,24834,24719,19647,24499,19649,229046,229047,24438,19650,229045,24487,19651,229043,19652,229041,19654,229044,24496,19656,229039,229040,24439,24488,19659,229042,19670,19694,19695,19696,19697,19698,19700,19701,19702,19703,19704,19705,19706,19707,19708,19710,19711,19712,19713,19749,19751,19769,19771,19772,19775,19778,19779,19780,19781,19801,19802,19819,19821,19822,19823,19824,19841,19848,19849,19850,19851,19852,19854,24454,19881,19886,19890,24449,19924,19941,20000,20001,20025,20060,20061,20294,20302,20585,20641,20824,20838,20877,20886,20973,20974,21407,47257,47256,229069,229072,229050,229051,229049,229048,24503,24461,21643,21648,21652,21654,21663,21664,21673,21696,21697,21703,21709,21711,21715,21720,21750,21769,21774,21808,21809,46011,21831,21832,21833,21834,21840,21842,21843,21844,21846,21847,21849,21850,21864,21915,21943,21955,21957,21996,21997,22000,22001,22013,22050,22054,22055,22056,22057,22058,22059,22060,22061,22062,22063,22064,22065,22070,22067,22068,22069,22071,22072,22073,22074,22075,22076,22077,22078,22079,22080,22081,22082,22083,22084,22085,22099,22104,22169,22170,22171,22172,22173,22174,22175,22176,22177,22178,22179,22180,22181,22182,22183,22184,22185,22186,22191,22192,22193,22194,22195,22196,22197,22198,22199,22200,22201,22202,22203,22204,22205,22206,22207,22208,22209,22210,22211,22212,22213,22214,22215,22216,22217,22218,22275,22284,22299,22301,22302,22304,22307,22308,22361,22379,22385,22397,22412,22439,22442,22475,39403,22596,22599,22602,24428,22632,38381,22654,22658,22674,22676,22730,22732,22747,22774,22782,22796,22875,22879,22884,22886,41479,22970,22976,22980,22987,23174,23182,23185,23224,23228,23235,23322,23372,23374,23406,23407,23415,23422,23435,23442,23444,23528,23531,23546,23549,23553,23564,23620,23685,23689,23690,23704,23707,23708,23782,23820,23839,23845,23848,23852,23853,23967,23978,40601,24088,24050,24089,24090,24091,24108,24128,24138,24139,24140,24141,24143,24166,24213,24229,24257,24264,24259,24309,24310,24506,24584,24597,24615,24616,24617,24631,24634,24635,24636,24637,24638,24639,24640,24641,24642,24643,24645,24646,24647,24664,24781,24782,24863,24864,24866,24867,24868,24869,24870,24871,24874,24877,24887,24900,24907,24936,24938,24941,24943,24945,24946,24953,24962,24963,25013,25098,25122,25172,25173,25174,25204,25209,25217,25230,25231,25234,25238,25239,25301,25308,25324,25325,25327,25328,25330,25331,25332,25334,25336,25337,25340,25343,25351,25354,25360,25366,30855,30944,30945,30946,30984,30985,31059,31062,31091,31092,31093,31094,31095,31102,31103,31104,31105,31106,31386,31387,31388,31389,31390,31391,31392,31393,31394,31395,31396,31397,31398,31399,31400,31401,31472,31520,31521,31630,31631,37730,31758,31759,31760,31761,31762,31763,31764,31765,31766,31767,31768,37747,37744,32431,32487,32488,32490,32491,32492,32493,40107,32626,32627,32628,32629,32630,32631,32632,32633,40106,32702,32703,32704,32705,93817,38042,38041,38040,38039,38038,38037,38034,38033,38032,38031,38030,38029,38028,38027,38026,38025,38024,38023,38022,38021,38020,38019,38018,38017,38016,38013,38012,38011,38010,38009,49277,37937,37920,37918,37862,37859,37844,37843,37841,37756,33969,93877,33985,33987,33991,33994,34161,34162,34163,34166,34169,34171,34176,41468,40238,34525,39010,34530,34532,34650,34653,34654,34656,34662,34714,34716,34725,34726,34990,34992,34993,34996,34998,34999,36753,40095,35067,40092,40082,35077,35079,35112,35121,35124,35130,41903,41901,41896,41181,41176,41172,41820,35897,35900,35915,35951,35952,35953,35954,35956,35969,35970,35971,35972,36027,36029,36032,36033,36034,36041,36042,36043,36044,36045,36046,36048,36049,36052,36053,36054,36055,36093,36094,36095,38185,36142,36143,36144,36157,36158,36159,36164,36165,36166,36183,36184,36185,36186,36197,36198,36199,36238,36239,36273,36306,36311,36324,36367,36371,36395,36600,36601,36603,36606,36607,36623,36673,36678,36714,36715,36716,36751,36771,36818,36819,36820,36821,36822,36942,36943,36973,37005,37040,37182,37184,37199,37201,37330,37379,37446,37475,37498,37535,37538,37626,37627,37635,37641,37644,37651,37655,38152,38188,38187,38401,38429,38431,38461,38462,38500,38568,38793,38805,38806,38807,38808,38809,38885,38887,38966,39015,39172,39173,39177,39186,39188,39212,39213,39214,39215,39360,39371,39372,39407,39565,39627,39825,39927,39928,39929,39930,39931,39932,39943,39944,40288,40289,40429,40458,40658,40696,40698,40737,40745,40746,40750,40764,40769,40783,40793,40873,40877,40912,41147,42582,41568,41449,41451,41471,41477,41499,41500,41501,42088,42089,42090,42093,42095,42097,42187,42189,42218,42294,42295,42296,42297,42298,42327,42353,42631,42433,42543,43122,43519,43520,43570,43571,43572,44028,44029,44030,44287,44288,44548,44558,44560,44834,45026,45028,45061,45071,45090,45091,45476,45480,45625,45841,45997,46144,46145,46147,46193,46194,46195,46197,46198,46246,46258,46312,46313,46334,46335,46374,46377,46382,46384,46385,46391,46514,46516,46520,46521,46522,46526,46556,46588,46630,46631,46632,46633,46635,46709,46710,46711,46712,46714,46715,46719,46774,47236,46811,46932,46933,47327,47365,47398,47399,47400,47401,47402,47403,47404,47406,47520,47521,47522,47523,48499,48498,48560,48586,48589,48682,48683,48703,48856,48857,48858,48860,48861,49008,49009,49010,49012,49015,49023,49042,49043,49044,49045,49046,49048,49050,49053,49103,49108,49172,49173,49189,49190,49285,49317,49319,49354,49603,49605,49714,49765,49770,49792,49795,49822,49906,49961,49962,49973,49992,49998,50007,50111,50113,50151,50153,50154,50158,50160,50162,50163,50247,50248,50320,50289,50302,50306,50321,50366,98358,50496,50537,50589,50598,50611,50612,50639,50640,50641,50642,50669,50670,50766,50841,50858,50859,50936,50937,50938,51499,51506,51507,51539,51545,51546,51561,51568,51610,51665,51668,51729,51739,51767,51769,52083,52090,52093,52094,52095,52118,52119,52221,52308,52318,52319,52320,52324,52325,52344,52345,52346,52347,52348,52769,52816,52818,52825,52832,52834,52836,52843,52855,52856,52865,52866,52919,52936,52937,52940,52944,55589,55590,55602,55603,55662,99687,55742,55835,55839,56135,56136,56124,56126,56381,52366,52368,52371,52376,52372,52379,52374,52383,52380,52386,52384,52409,52413,52464,52469,52467,52619,52685,52687,59059,59643,59752,59770,59966,64715,75324,68677,71546,81866,81876,212589,212590,212591,212592,79438,62260,62277,62293,76492,76513,76605,86508,75659,75662,75656,86509,86510,74712,74719,74711,75105,82256,81601,212919,212908,86511,65150,61711,61819,61723,61725,61845,61847,61862,62051,62143,62063,62187,62190,62191,62194,77165,77173,77172,77168,77174,77205,77137,77180,77177,77194,77207,77140,77142,86517,61865,61777,61807,61805,61733,61800,61731,61928,86516,61924,61822,61877,61820,61836,61839,61840,61809,61743,61741,61746,61803,61739,61755,61750,61752,61748,62272,62210,62066,62109,62169,62163,62070,86515,62127,62068,62268,62147,62222,62145,62150,62166,62167,62133,62081,62078,62083,62130,62076,62089,62087,62091,62085,86514,62003,62013,62011,62009,61832,61834,61830,62017,62019,62015,62342,62346,62348,62344,62160,62162,62157,62370,62373,62367,81930,81938,81935,62517,81744,81759,81754,81747,81753,81894,81925,81899,81919,81729,81736,81731,81763,81767,65259,65270,65310,61681,61708,61674,82728,79503,82506,82397,79506,82398,82632,79629,79628,79400,82408,82407,60592,82406,79405,79457,79407,79408,79406,79630,82663,79632,79633,82636,62494,62596,80570,68722,68771,68057,68083,68103,68111,68121,68095,68115,68100,68128,68150,68155,68157,69483,69496,69512,65734,81158,81607,81614,81625,81635,81629,81556,81646,81654,81647,81660,81582,81578,71362,71369,70756,70759,70761,70767,70776,70951,70779,70782,70796,70785,71038,70958,70801,70827,70806,75830,75824,75839,75835,75844,76242,76263,76278,76266,76245,75851,75857,75848,75860,76250,76330,76261,76258,76249,73361,73410,73390,73733,73425,73429,73421,73440,73448,73443,73452,73433,73729,73472,73484,73463,64874,62543,62546,73488,73493,73502,73498,73510,73506,73517,73519,73514,73530,73522,73544,73568,73541,73573,73537,62700,75867,75870,75864,75873,61063,79640,82644,81845,81863,81860,79641,79643,79642,79644,79647,73159,73176,73057,61114,78592,60904,69568,69583,70247,64480,77178,71539,71458,62941,70178,70182,60816,70692,62847,62849,92567,62870,92549,62881,63194,63170,62852,62821,62884,62974,212185,212186,62976,62908,63013,63324,92563,63339,62987,212532,212533,212534,212535,62983,62913,63020,63407,63410,78477,78416,92555,212538,212539,92586,63073,63604,63598,63539,63547,78663,92554,78713,92553,78647,78652,92552,78654,62404,62389,62364,62407,62417,62421,62424,62426,62428,62439,212188,212187,62394,62397,62444,62448,62453,62431,62478,92587,86498,86497,76525,76637,71636,86495,71107,92556,216845,216846,216848,216849,216851,216852,92547,82702,82700,92546,82130,70742,70744,70746,75797,75794,212214,212213,75799,76125,76126,76129,79418,217227,217228,217229,79422,82429,82431,82430,82432,79429,60642,79430,79432,79431,82738,61472,66926,76095,78460,61354,61572,61356,61574,83155,74002,67059,68426,78464,78358,78373,78322,60901,60930,60921,71238,71017,69589,71223,69766,71233,69774,63728,63700,63698,72966,72976,63724,86586,75985,76230,66004,66036,66041,66046,65944,65949,65940,65951,65957,76436,81688,67842,67835,67950,67965,67948,68945,82079,80101,75101,75027,80100,67047,74861,74864,74858,67168,67086,67092,67113,75036,86555,74571,74576,83147,76719,76721,80481,60909,82572,60906,61993,62330,74353,74350,76145,76217,76380,75405,75414,75411,75408,75969,75960,75956,76368,75437,76149,76240,76391,81877,64745,64737,75712,75734,75739,75736,75729,75744,75740,75751,75748,73218,73236,67946,69011,69016,68897,68901,68892,67485,67488,67490,67481,67498,67495,67505,67502,67508,69021,67518,67516,67522,68909,68911,68916,68908,68906,68921,68924,68919,68930,69101,78685,86538,78334,67831,67824,67833,67821,67839,86605,92495,216982,74741,74731,212694,212695,212696,212697,212688,212689,60902,72979,72955,73928,71974,68878,77472,74000,74063,74049,65077,66608,64534,75117,75886,61312,82185,62321,80109,68984,73924,71289,72970,76692,75442,76695,63138,80712,80717,71049,70315,70753,79386,82625,82626,81904,75908,75911,62713,63692,63714,63684,74775,74772,72626,72644,72673,72615,72622,72616,72635,72630,74325,63254,63439,63434,63437,63422,63424,86568,63426,86569,63418,86570,63583,86574,75017,86543,86546,86545,86544,86548,63754,83127,83128,72760,80802,80773,80777,71182,71198,70720,70719,70730,71203,70731,63234,63237,63249,63380,63388,86562,72891,72720,72693,72727,72770,72775,86557,74444,72752,72738,66227,65389,65395,68628,67212,67401,67404,67400,68473,68001,63676,63736,77590,77652,77593,77968,77970,77923,77926,72848,72840,75812,75607,75620,75623,75810,75806,74263,74260,74254,82346,82347,72370,72442,72437,72544,72549,72568,72583,72574,72812,72375,72758,79585,82098,79575,82114,79583,79584,67604,67572,76135,76122,76644,86501,76471,86502,76474,76467,76689,76691,76687,86503,76603,76646,86500,76507,76124,74093,83081,83082,83083,74087,74098,68584,68579,67631,67615,67627,67622,68572,61458,62035,62045,62030,80039,63178,77014,77011,71979,80160,80162,80164,80171,80183,70715,80186,70712,70714,71072,71066,71077,70716,77556,77717,77720,77844,77746,77723,77561,77564,77731,77734,77808,75884,73586,78824,73602,82204,81078,82209,79087,77643,83144,83146,75931,75928,75318,75321,75833,75802,75804,86573,69106,68933,68927,68936,61352,61569,61445,83169,86607,83166,92500,83165,74188,73750,74192,82377,82376,82379,62842,62862,82069,82076,82026,82032,82041,68015,67993,69002,68817,82778,60801,86596,60808,60814,60812,60810,69007,64357,64757,64896,64345,64753,64754,64748,74777,74790,74788,80102,82366,83158,86601,80108,80104,80105,83156,80110,80111,74604,75082,74601,82356,82354,82355,83132,83133,83134,64526,64732,60878,82137,76070,75381,76267,76067,76058,74973,74953,64491,82360,82489,79624,82627,67800,67175,67180,67171,67186,67408,67414,67416,67234,67241,67228,67220,67224,68038,67260,67266,67275,67270,67279,63841,64030,63786,64122,64042,64038,63947,63950,63442,63466,63469,63531,73704,68539,68545,216944,216945,216946,216947,68547,212540,67662,73708,73653,69552,71514,70750,70740,70748,71396,71519,71401,71536,68887,63825,63828,75501,75499,75524,75525,75521,75517,75519,75515,61214,82704,61197,82693,82703,82705,61202,77604,86533,76116,60869,82548,65490,82177,82180,77763,68412,65313,65487,65319,68401,68406,68396,68417,68421,70341,65909,65918,65923,65926,65914,82783,61554,80527,80541,80278,80571,80579,80581,61599,61602,61589,61586,61499,61501,74328,75616,75610,76406,61954,61948,62288,62286,82735,82726,61456,75256,81799,81811,81802,81816,61441,75344,75259,75250,75265,75268,75262,75252,80835,80790,80791,81870,82607,63561,86577,63563,86579,63570,86580,63574,86581,63622,86583,63612,70823,70820,71131,71136,70038,70029,70045,70830,62944,62798,86526,62824,68312,68322,69032,68315,68319,67197,67194,68611,67389,67384,67396,66550,75758,75916,73287,67684,67678,67735,78514,78328,67077,65565,65568,80588,80561,80293,80604,80610,86541,67032,67068,76328,212345,212346,212347,212342,212343,212344,212341,76287,76298,76602,76519,83135,76167,76089,76087,76284,76096,76085,76100,77942,82212,75636,75640,71090,77755,73891,71085,71093,74071,74052,76153,74056,86584,77751,77791,71140,92490,71163,62209,62207,70983,70977,77753,86531,77760,65844,86582,65674,65848,65679,65854,65837,81681,68978,68969,68955,68950,68959,68813,68965,67974,67979,67969,67986,67990,67983,68974,81657,79619,61476,82737,81820,75144,75145,75141,74970,74508,81720,64168,62324,62251,62249,83168,86604,212945,212944,81663,73021,73094,75232,75003,69888,69894,71284,71281,69899,60780,209650,209651,209652,209653,209654,209655,209656,209657,73858,73855,212173,212172,73851,73644,73647,73651,74215,73770,73630,73627,73633,74212,74206,74202,74221,74217,72698,72876,86600,77548,61098,61099,93718,60827,82528,60829,60834,60837,60835,60839,60841,60843,61372,61384,61388,61374,61265,61268,61307,61309,61273,73661,74236,74227,73691,73693,72794,72791,72786,72797,72818,72788,72800,72802,74225,73861,73702,73867,73317,72871,73697,72551,74275,73794,73878,73699,74250,74323,73258,72494,72509,72516,73768,72388,72383,73799,72397,77290,68327,68337,68341,68351,68346,68357,66613,63494,63315,63351,63383,86564,63386,63391,86567,74299,74320,74282,77495,77492,67340,68216,68210,68222,68234,68228,68240,68243,67582,67586,67577,68254,68284,68249,67533,67829,68292,65697,65709,65714,65803,66392,66386,66398,66193,66197,66225,86542,66221,60666,82444,60918,71259,69788,69810,70084,70089,70070,71248,71240,71246,70899,71253,70903,60607,60718,79467,82543,82696,82707,61205,82697,61864,62198,62020,61671,61891,62232,67998,64777,64823,64387,64477,64705,77540,77684,77655,77812,77551,77078,76289,76151,76157,76164,76179,76160,76711,75992,212220,212221,212222,212215,212216,212217,212218,212219,76026,76018,74060,74005,74047,74036,74044,212920,212921,212922,212923,212924,212925,73986,73977,73992,73971,73988,74042,73939,73957,73942,73933,73937,74119,74114,74123,74118,73914,73911,73920,73925,76439,75130,75114,75132,75097,75138,75135,75111,75099,65982,65930,66617,66622,66921,66934,66930,66882,66887,66914,66891,66924,66879,66886,65132,65136,65124,65128,65121,64547,64559,65112,65119,65083,65073,65081,64556,64550,64553,64544,64835,64537,64831,64828,62228,62230,77331,77328,71475,71523,71530,77452,74724,74993,68498,68494,86606,61504,61534,61532,61551,77464,77356,217224,217225,217226,77358,77470,77437,86550,86549,71472,71643,71465,71553,71462,71443,71447,71453,71407,71427,71532,71438,71433,70243,70238,70228,70234,71542,70185,70172,70255,70942,70948,70160,70165,70188,70133,70124,70998,70146,70154,70151,70191,68940,82686,68989,82670,67938,67942,77796,77622,74667,74664,68883,67466,67461,67471,68365,68373,68868,68827,68838,68863,68873,68834,68823,77429,77424,77423,77308,61911,61986,61883,61886,61982,86599,61881,73753,73836,74659,82522,60818,60938,77578,60940,60942,60799,82515,86598,82514,86597,77673,77675,77678,79634,82564,79636,79635,75673,61060,69559,69562,60903,62838,62795,62806,62809,63456,62775,62778,62781,62803,78597,78556,78577,78554,75946,75934,75937,74312,74310,74307,68698,67816,68704,78571,82106,77081,80837,80833,77535,70721,71499,71391,71495,92568,70737,70739,75891,73327,73330,86593,73377,73320,73051,73324,73044,73039,73186,73187,73308,73297,73046,73909,73903,72852,73810,73808,73190,73181,73156,73125,73137,73144,73172,73131,73148,73165,72905,73115,72913,73118,73722,73717,73031,73035,81644,81631,81626,81649,72994,81610,81620,81613,72999,69843,69760,69754,71228,72983,72961,80744,80705,80711,80330,80804,72948,80352,63394,63398,63231,63289,63377,86559,63356,63220,63223,63217,63206,63175,63197,63184,63161,63140,63134,63084,63129,63087,63102,63131,63081,63108,63100,60583,60580,60578,80204,80205,80226,80225,60469,60468,69929,69744,69749,69962,69966,70104,70097,67440,67425,67434,67436,67443,67424,73197,73080,73070,73075,76878,76881,76888,76875,64802,64810,64806,64785,64454,65047,64783,65051,65007,65069,65043,65067,63125,63090,63119,63116,69683,75212,75217,66727,66731,66736,66740,66746,66754,76110,75949,75941,75214,75220,71051,70294,70310,71043,70429,70424,70727,70725,69736,71409,71419,71415,75092,75074,75076,74728,75060,75041,75063,75054,75039,75090,75057,74579,74562,75031,75030,74935,75087,60685,60687,79458,74867,74874,74877,74855,74871,86547,67164,67117,80129,80130,74852,86539,86540,67081,67743,68684,68691,67073,65549,65557,65537,65561,65546,65542,65521,65526,65408,65534,86572,66538,66542,66545,76029,86590,76050,76032,76041,86588,73605,73610,73617,75919,75922,82762,82763,76036,86589,75365,76038,77789,77698,76017,212594,212588,212537,80795,80792,80728,80737,80786,80731,80695,80701,78678,78682,78643,78691,78634,78672,78674,78620,212189,78667,78445,78480,78331,78361,78482,78448,86537,78451,78438,78403,86536,78347,78365,78325,78319,78312,78315,86534,76093,76273,76275,76271,92565,74933,75012,81778,81734,81740,76553,76559,76543,76489,69852,71336,71351,76487,71330,71332,69919,71325,71321,71314,71318,69827,71304,71297,74647,75009,74928,74656,74922,74915,74912,75004,74918,92492,92493,76550,92494,76556,76534,76484,82380,76532,76528,76547,76545,79500,212174,79383,79497,79496,82378,60766,82375,60763,82368,82367,79502,79489,79488,60883,82371,82370,82369,82365,82364,68709,67804,67764,68669,67739,68648,68654,67926,67674,67930,67921,70860,73895,73898,70722,70723,71489,71485,70395,70397,70393,70361,77580,70356,70368,70348,77799,77705,77786,77726,76324,76170,76321,76315,76187,76318,75503,75513,75816,75511,75509,75505,75821,75818,75507,75924,75639,76295,76292,76312,75630,75632,75634,75311,75327,66900,66800,64665,64718,64766,64774,64760,73269,73272,64930,64655,64933,64927,73251,82237,82224,64839,64849,64652,64843,216981,70910,70906,70915,70724,71503,71516,71481,61652,70752,70733,70735,70335,99972,70339,69731,69715,69728,62203,62274,62205,61517,61593,61591,60479,79455,81483,60264,82414,81586,81581,79102,79104,82260,82263,79084,79085,60260,79103,74721,74950,74945,74948,74982,74976,74979,75023,75015,75020,74530,74542,65344,74524,74593,74598,74583,74512,74516,65955,65727,74689,74682,74685,76355,76353,65972,66642,66372,66424,66420,65963,64484,65333,65376,65339,66020,66017,65977,66626,66647,66628,66637,66632,79478,64720,64726,64708,64523,64730,64936,65997,66156,66001,76344,66152,65993,65988,75389,75966,75394,75398,75392,76142,76143,212355,212356,212348,212349,212350,212351,212352,212353,76139,76210,76212,76214,80511,76203,76350,92483,75386,76133,212175,76207,212955,212956,212957,212953,82363,64378,64468,64473,64462,64701,66314,66309,66329,66340,66334,66349,64382,64384,67124,67098,67129,67134,67138,67144,67108,67111,67064,68431,67055,61335,82780,61932,82779,60972,82600,82596,60957,82420,82422,82421,61280,82752,61379,80483,80507,80474,80480,80843,80458,80468,80463,80842,80453,80495,80832,80838,80493,61145,61147,61110,61108,61086,82605,82606,82604,82085,82043,82603,82088,60979,79596,82074,82070,79594,60960,60956,82029,82046,82036,82024,82016,82022,79586,60954,79587,82013,82006,81979,81990,81985,81974,79394,82097,82400,60569,79578,79579,79577,74483,73093,73110,74091,79994,212961,212962,212963,212958,212959,212954,79997,79998,79999,63061,63065,63004,63005,62951,62954,62999,62997,62858,62827,62831,62834,62878,62855,63549,212225,212226,212227,212228,212223,212224,63518,63272,74549,74534,74493,74490,74494,76867,61439,82723,76854,61217,75881,61649,64349,64901,64894,64353,64741,64742,82361,76590,76596,76593,74797,65381,80486,79410,80467,80478,64679,64681,65652,65662,65666,82189,82002,81787,81781,81792,82020,81995,81986,80848,80846,71272,80844,69816,71270,71263,69780,71266,70770,71549,71012,69871,71034,71024,71026,69970,71021,70991,70050,71187,69858,69865,70718,70717,70875,70713,70711,70710,70709,70443,70708,70446,70841,70865,70837,71158,70867,70872,70869,71121,70833,71114,63945,63940,63831,64171,64024,64018,63838,63834,69025,92489,68783,67876,68479,68476,68470,67918,67207,67667,67893,67891,67879,67889,67885,68457,68466,68505,68463,65147,65142,65140,65171,74544,74551,74547,79470,62873,62818,75095,81715,81711,82348,79474,81671,81676,81684,77596,74617,74552,74609,72826,72837,72832,72822,73339,73347,72814,72898,72522,72430,72525,72418,72426,72422,72413,74267,72409,74278,73802,72560,72556,73805,74257,72404,73759,73843,73838,73686,72783,72780,73659,72856,72749,72860,73780,73784,73786,73639,73637,73822,73643,73772,73871,73874,73775,73833,73621,73625,73763,74180,74174,74184,73310,73848,73728,73314,74200,74196,73824,73828,74148,74165,74171,73817,73815,61576,61450,72740,76714,61357,61651,61448,61342,61556,61344,61647,61433,61645,61567,61431,61349,61564,61347,61566,61345,61558,61429,61643,61640,61426,82806,61424,61552,61337,76281,76078,76269,76082,81881,81873,76004,76362,210082,75434,76238,76138,75429,76147,76001,76236,75998,76232,75972,76359,75417,75421,75990,76226,76220,75987,75981,76223,209799,75975,75978,212190,76357,76375,76374,76348,76346,76198,76200,76192,76131,76120,75380,75384,76076,76064,76181,76190,75964,75962,75377,75374,79487,212252,212249,212250,212251,212247,212248,79574,79486,82362,60757,82578,82576,82631,79625,82628,82488,82359,82486,82487,82358,82357,82485,60745,82675,82676,61151,76858,76864,76862,76855,75300,75338,61595,77784,82804,75204,75193,210083,75198,82446,79569,79568,60507,60890,60892,82565,82352,82351,82350,82349,76683,76680,212931,212926,212927,212928,212929,212930,76717,82143,82253,82249,82139,60874,60876,82549,60741,82546,79476,79540,79473,82544,79475,60658,60654,82438,82244,79469,79472,79471,82229,82219,82242,82234,82190,82205,60627,82200,82425,82419,60622,60723,60609,82674,82673,212709,212710,75078,74606,75080,212262,212263,212264,212257,212258,212259,212260,212261,212253,212254,212255,212256,70120,67454,67458,82695,61204,82706,82690,79462,60709,79460,79537,82195,82168,82164,79535,82171,60850,81957,82539,79532,81950,79459,81944,82146,74356,82461,60478,76678,74409,74329,80739,80742,80734,80726,80720,80724,80688,80690,212177,212178,212179,212176,212268,212269,212265,212266,212267,77583,72894,72885,72702,72724,72713,72687,72709,72705,72717,72675,75780,75784,75786,75789,62258,212595,209994,75776,61917,62125,62123,75764,73282,78065,81910,81912,75901,75905,75894,75888,75898,78822,76822,73230,75705,75708,75691,75694,75882,79993,75677,75681,75683,75685,75688,74793,75679,75875,75879,74802,81893,81898,74804,76571,76575,76581,82450,79446,82449,76817,76814,212366,212357,212358,212359,212360,212354,76811,76838,76849,76835,76832,74783,74785,81825,79617,79618,65603,65597,65583,65589,67637,68758,67566,68853,68765,80816,82650,61937,61934,61936,81615,74747,74704,74706,74696,75104,75107,64569,62583,62611,76609,76639,76607,76510,76504,76499,76502,75489,75792,82608,75480,75483,75486,75478,76432,75457,76412,76409,82822,82821,61632,212609,212610,212611,212613,62239,82820,61629,75445,75272,75454,75450,76388,76365,75614,76382,61480,61478,82739,81822,81869,81864,81886,81585,82611,82613,82612,82616,61470,86496,82734,61630,61956,62328,62132,61990,61788,61869,62214,61988,62326,61871,62216,62282,61949,61873,62218,81856,81818,82385,79381,81806,79385,81794,61658,61685,62038,82563,82560,82562,79556,79388,79387,61656,61454,61443,82725,82724,63110,63114,83329,83330,83331,83332,83333,83334,83335,83336,83337,83352,83353,83354,83355,83356,83357,83358,83359,83360,83361,83362,83363,83660,83662,83663,83664,83668,83709,83710,83712,83802,83815,83818,83819,83829,83830,83831,83832,83912,83913,83914,83957,84790,84792,84796,84798,84801,84805,84883,84886,84890,84893,84897,84901,84905,84908,84910,84915,84919,84923,84929,84933,84938,84954,84956,84988,84997,85353,85372,85390,85393,85394,85659,85972,86068,86109,86112,86131,86244,209870,209871,209872,212597,212598,212600,212601,212605,212606,210041,210042,210043,210046,210047,210048,210049,210052,210053,210055,210057,210058,210059,210060,210061,210062,210063,210064,210065,210066,210067,212279,212280,212284,212285,212278,210156,210157,210158,212545,212542,212543,212544,210073,210074,212747,212739,212740,212741,212742,212736,212737,212738,212732,212733,212734,212735,212729,212730,212731,212726,212727,212728,212722,212723,212724,212725,212719,212720,212721,212715,212716,212717,212718,212712,212713,212714,212711,212706,212707,212708,212939,212940,212941,212935,212936,212938,212933,212934,92952,92953,93077,93078,93270,93472,93483,93484,93485,93486,93487,93495,93496,93497,93498,93508,93511,93512,93513,93735,93737,93742,93762,94188,94190,94191,94259,94262,94439,94732,94742,94756,94758,209552,94810,212171,212145,212146,212147,212148,212149,212150,212151,212152,212153,212154,212163,212164,212165,212166,212167,212168,212169,212170,210239,210240,210214,210215,210212,210210,210211,210196,210197,210198,210199,210200,210201,210203,210205,210206,210207,210208,210209,216937,216938,216939,216940,216941,216942,216943,216928,216929,216930,216931,216932,216933,216934,216935,216936,209887,217787,216921,216922,216923,216924,216925,216926,216927,217616,217617,217618,217619,211429,211430,209889,209225,209226,209227,213012,209890,213000,209891,209892,209893,209894,209895,209814,209816,209817,209834,209835,209836,209837,209838,209839,209840,209841,209842,209843,209844,209845,209846,209847,209848,209849,209850,209851,209852,209853,209854,209855,209856,209857,209858,209859,209860,209861,209862,209863,209864,209865,209866,209867,209868,209888,213077,213073,213076,210195,210193,210194,213072,213070,213071,213069,213064,213065,213066,213057,213058,213059,213060,213061,213051,213052,213053,213054,213045,213046,213047,213048,213049,213050,213043,213044,213039,213040,213041,213042,213036,213037,213038,213032,213033,213034,213035,213029,213030,213031,213025,213026,213027,213028,210189,210191,210192,210188,210185,210186,210183,210184,210179,210180,210181,213021,213022,213024,213013,213019,213020,213016,213017,210178,210176,210177,210175,212993,212994,212982,212983,212984,212985,212986,212987,212988,212990,209283,212977,212978,212979,212980,212973,212974,212975,212976,210174,210172,210171,212910,209310,212874,212875,210169,210170,210163,210164,210165,210167,210168,212871,212872,212873,212868,212860,212861,212862,212863,212854,212855,212856,212857,212858,212859,212850,212851,212852,212853,212846,212847,212848,212849,212841,212837,212838,212839,212840,212832,212833,212834,212835,212836,212827,212828,212829,212830,212831,212822,212823,212824,212825,212826,212816,212817,212818,212819,212820,212810,212811,212813,212814,212815,212803,212807,212809,212797,212798,212799,212800,212801,212802,212792,212793,212794,212796,210160,210162,212783,212784,212786,212787,212780,212781,212782,212690,212691,212692,212693,212683,212684,212685,212686,212687,212678,212679,212680,212675,212676,212677,212670,212671,212672,212673,212674,212666,212667,212668,212669,212661,212662,212664,212665,212659,212660,212634,212635,212636,212637,212638,212639,212640,212641,212642,212643,212644,212645,209267,212624,212625,212626,212619,212620,212621,212622,212623,212615,212616,212617,212618,212614,212583,212584,212586,212587,212578,212579,212580,212582,212573,212574,212575,212576,212528,212608,212518,212522,212517,212507,212508,212509,212510,212501,212502,212503,212504,212505,212506,212498,212499,212500,212493,212494,212495,212496,212497,212491,212492,212474,212475,212476,212477,212478,212466,212467,212468,212469,212470,212471,212472,212473,212464,212465,212461,212462,212454,212455,212456,212457,212458,212459,212460,212440,212441,212442,212443,212444,212445,212446,212447,212448,212449,212450,212451,212452,212453,216910,216917,216918,216919,216920,217734,93727,93725,93726,211172,211173,211412,216801,216802,216803,216804,216805,216806,216808,216809,216811,216814,216816,216817,216819,216823,216824,211174,211175,211176,211177,211178,211179,211180,93728,93722,93724,216836,216837,216839,216840,93721,211186,211183,211184,211191,216826,216828,216829,216830,216795,216796,216797,216798,216799,220726,211192,211210,216832,216833,216835,211224,93720,211292,211293,211294,211297,211298,211299,211300,211301,211327,211328,93719,211348,211349,211377,211378,211379,211376,211422,211413,211414,211415,211416,211417,211418,211419,211420,211421,209243,209244,92176,212191,92557,92571,212964,212965,210129,92482,212763,212764,212758,212759,212760,212761,212762,212754,212755,212756,212757,212751,212752,212753,212748,212749,212750,212743,212744,212745,212746,216959,216960,216961,216962,216963,216964,216965,216966,216967,216968,216970,216971,216972,216973,216974,216975,216976,216977,216978,216979,216980,96157,210130,210131,210134,210136,210141,210142,210143,210146,210147,210149,210150,210151,210152,210154,210155,210024,210025,210026,210027,210028,210029,210030,210031,210032,210033,210034,210035,210036,210037,210038,210039,210040,96138,96137,96131,96130,96127,209995,209998,209999,210000,210001,210002,210003,210004,210005,210006,210007,210112,210110,210111,210109,210108,210106,210105,210102,210101,210100,210098,210099,210097,210096,210095,210094,210092,210093,210090,210089,92484,92485,92486,212966,210087,210088,92445,92446,212967,210075,210077,92559,92561,212571,212572,212565,212566,212567,212568,212569,212570,212559,212560,212561,212562,212563,212564,212554,212555,212556,212557,212558,212551,212552,212553,212546,212547,210086,210084,212310,212311,212312,212313,212314,212304,212305,212306,212307,212308,212309,212302,212303,212292,212293,212294,212295,212286,212287,212288,212289,212290,212291,210085,210012,210013,210014,210015,210016,210017,210018,210019,210020,210021,210022,210023,209875,209878,209879,209880,209881,209882,209883,209884,209885,209886,209992,212375,212376,212361,212362,212363,212364,212365,92550,92548,209233,209234,209235,209236,209237,209238,209239,209240,209241,96288,96284,96265,99836,99837,212968,212969,210079,210080,210078,212607,209990,92251,92267,92268,92270,92275,92291,92294,92304,92317,92322,92328,210072,210071,210069,210070,209703,209704,209705,209706,209707,209708,209709,209710,209712,209714,209715,209716,209717,209718,209719,209720,209721,209722,209723,209724,209725,209727,209729,209730,209731,209732,209733,209734,209735,209736,209737,209738,209739,209740,209741,209742,209743,209744,209745,209746,209747,209748,209749,209750,209751,209752,209753,209754,209755,209756,209758,209759,209760,209761,209762,209763,209764,209765,209766,209767,209768,209769,209770,209771,209772,209774,209775,92333,209899,209903,209904,209905,209906,209907,209908,209909,209910,209911,209912,209913,209914,209915,209916,209917,209918,209919,209926,209927,209962,209963,209964,209965,216956,216957,216958,212970,209948,212943,209991,209949,209950,209951,209952,209953,209954,212200,212201,212196,212197,212198,212199,212192,212193,212194,212195,209993,209874,209783,209784,209785,209786,209787,209788,212337,212338,212339,212340,212332,212333,212334,212335,212336,212327,212328,212329,212330,212331,212323,212324,212325,212326,212319,212320,212321,212322,212315,212316,212317,212318,209985,209984,209983,209981,209982,209980,209979,209977,209978,209976,209974,209970,209966,209565,209566,209567,209568,209570,216948,216949,216950,216951,216952,216953,216954,216955,209943,209944,209945,209947,209941,209942,209940,209932,209933,209934,209935,209930,209931,209873,209667,209668,209669,209670,209671,209672,209673,209674,209675,209676,209677,209678,209679,209680,209681,209682,209683,209684,209685,209686,209687,209688,209689,209690,209691,209692,209693,209694,209695,209696,209697,209698,209699,209700,209701,209702,212417,212418,212409,212410,212411,212412,212413,212404,212405,212406,212407,212408,212398,212399,212400,212401,212402,212403,212393,212394,212395,212396,212397,212388,212389,212390,212391,212392,212383,212384,212385,212386,212387,212377,212378,212379,212380,212381,212382,212369,212370,212371,212372,212373,212374,212367,212368,212430,212431,212435,212429,212421,212422,212423,212414,212415,212416,212182,212183,212184,212180,212181,92499,212234,212235,212236,212237,212238,212229,212230,212231,212232,212233,92501,92360,212981,209809,209810,209811,209812,209813,209807,209808,209637,209638,209639,209640,209641,209642,209643,209644,209645,209646,209647,209648,209649,209584,209554,209555,217665,217666,217667,217214,217215,217216,217217,217218,217219,217220,217221,217222,217223,213158,213127,209800,209801,209802,209803,209804,209805,209583,209587,209575,209576,209577,209578,209579,209580,209581,209582,209658,209659,209660,209661,209662,209663,209664,209665,209666,209558,209559,209560,209561,209562,209563,209564,209557,209586,209585,209476,209477,209478,209479,209480,209481,209482,209483,209484,209485,209486,209487,217663,217664,217203,217204,217205,217206,217207,217208,217209,217210,217211,217212,217213,209613,209614,209615,209616,209617,209618,209619,209620,209621,209622,209623,209624,209625,209626,209627,209589,209590,209591,209592,209588,209550,209551,209527,209528,209529,209530,209531,209532,209533,209534,209535,209536,209537,209538,209539,209540,209541,209543,209556,209448,209449,209450,209451,209452,209453,209454,209455,209456,209457,209458,209459,209460,209461,209465,209466,217668,217669,217596,217196,217197,217198,217199,217202,209628,209629,209630,209631,209632,209633,209634,209610,209611,209612,209593,209594,209595,209596,209597,209598,209599,209600,209601,209602,209603,209605,209606,209607,209608,209609,209549,209544,209545,209546,209547,209548,209524,209525,209523,209517,209518,209519,209520,209521,209522,209513,209514,209515,209516,209507,209508,209509,209510,209511,209397,209398,209399,209400,209401,209415,209416,209417,209418,209423,209424,209425,209426,209427,217659,217660,217661,217190,217191,217192,217193,217194,217195,209553,209446,210244,210246,210247,210248,210249,209445,209385,209386,209526,211181,209441,211182,209512,209434,209431,209432,209433,209430,209382,209379,209380,209381,211193,211194,211195,211199,211201,211202,211203,211204,211205,211207,211208,211209,217656,217657,217658,217179,217180,217181,217182,217183,217184,217185,217186,217187,217188,217189,209447,209388,209389,209245,209246,209247,209248,209249,217653,217654,217655,217171,217173,217174,217176,217177,217178,209396,209394,209390,209391,209364,209365,209387,209350,209355,209293,209294,209295,209296,209297,209298,209299,209300,209301,209302,209303,209304,209305,209306,209307,209343,209344,209345,209346,209342,209313,209314,209315,209316,209317,209318,209319,209320,209321,209322,209323,209324,209325,209330,209331,209332,209333,209334,209335,209336,209337,209338,209339,209340,209341,222250,217651,217652,217164,217165,217167,217169,216532,209378,209377,209375,209376,209371,209372,209373,209374,209366,209367,209361,209362,209363,209356,209360,209308,209284,209285,209286,209287,209288,209289,209290,209291,209292,209281,209282,209280,209276,209277,209278,209279,222251,217650,217151,217153,217155,217158,217159,213254,213255,98087,98088,98089,98090,98092,98094,98170,98175,98207,98213,98356,98357,98368,98439,98512,98539,98685,98686,98922,98923,98924,98925,99003,99004,99005,99006,99007,99008,99009,99011,99067,99068,99070,99075,99083,99084,99085,99091,99092,99093,99100,99179,99180,99181,99182,99183,99190,99191,99192,99193,99201,99510,99511,99528,99529,99530,99675,99703,99705,99719,99768,99771,99772,99826,211165,211169,211170,211171,217143,217145,217147,217150,213159,212141,212140,212138,212139,209268,209269,209270,209271,209272,212995,212996,212997,212998,212999,213007,213008,213009,213010,213011,213006,217648,217649,217130,217132,217135,217137,217139,217140,217646,217647,217120,217126,217128,213124,217644,217645,217111,217114,217115,217116,217117,220636,217642,217643,217101,217104,217106,217107,217108,217109,217700,217640,217641,217094,217095,217098,217099,216499,216459,213157,212991,212992,101778,101779,101780,101891,176841,183618,184538,184768,185536,185540,186045,217697,217698,217699,217638,217639,217081,217082,217085,217087,217090,212246,212239,212240,212241,212242,212243,212244,212245,217691,217692,217693,217695,217696,217635,217636,217637,217059,217061,217062,217063,217066,217069,217071,217075,217076,217079,217688,217689,217690,217633,217634,217049,217051,217052,217053,217055,217056,217684,217685,217687,217631,217632,217039,217041,217042,217044,217045,217046,213160,217682,217683,217629,217630,217031,217032,217033,217035,217680,217681,217627,217628,217018,217026,216465,217678,217679,217626,217011,217675,217676,217677,217624,217625,216999,217000,217001,217003,191341,191342,211425,211427,211423,211325,211326,217670,217671,217672,217673,217674,217620,217621,217622,217623,216989,216992,216997,216984,217230,217231,217232,217233,212436,212437,212438,212439,212202,212203,212204,212205,212206,212207,211187,211188,211190,211278,211279,211280,211281,211282,211283,211284,211285,211286,211287,211288,211289,211290,211291,211334,211336,211337,211338,211339,211340,211341,211342,211344,211345,211346,211347,211313,211314,211315,211316,211317,211318,211319,211320,211321,211322,211323,211324,216663,216668,216669,216670,216674,216675,216676,216677,216680,216681,216683,216684,216685,216686,216689,216690,216691,216693,216694,216695,216696,216697,216698,216699,216700,216701,216702,216705,216706,216707,216708,216709,216710,216717,216722,216723,216728,216729,216730,216732,216733,216734,216736,216739,216740,216743,216744,216746,216747,216748,218967,218871,218890,218851,218854,211211,211212,211213,211214,211215,211216,211217,211218,211219,211220,213216,211225,211226,211227,211228,211229,211230,211231,211232,211233,211234,211235,211236,211237,211238,211239,211240,211241,211242,211243,211244,211245,211246,211247,211248,211249,211250,211251,211252,211253,211254,211255,211256,211257,211258,211259,211260,211261,211262,211263,211264,211265,211266,211267,211268,211269,211270,211271,211272,211273,211274,211275,211276,211277,217460,217744,217745,213092,211185,217611,217612,217613,217615,217267,217268,217269,217270,217271,217272,217273,217274,217275,217276,217277,217278,217279,217280,217281,217282,217283,217284,217285,217286,217287,217288,217289,217290,217291,217292,217293,217294,217295,217296,217297,217298,217299,217300,217301,217302,217303,217304,217305,217306,217307,217308,217309,217310,217311,217312,217313,217314,217315,217316,217317,217318,217319,217320,217321,217322,217323,217324,217326,217327,217328,217329,217330,217331,217332,217333,216914,216915,218858,218861,217234,217235,217236,217237,217238,217239,217240,217241,217242,217243,217244,217245,217246,217247,217248,217249,217250,217251,217252,217253,217254,217255,217256,217257,217258,217259,217260,217261,217262,217263,217264,217265,217266,216464,216908,216454,213214,213215,212524,211329,211330,211331,211302,211303,211304,211305,211306,211307,211308,211309,211310,211311,211312,211163,211399,211400,211401,211403,211404,211405,211406,211407,211408,211409,211410,211411,211382,211383,211384,211386,211387,211395,211396,211397,211398,211392,211393,211394,211350,211351,211352,211353,211354,211355,211356,211357,211358,211359,211360,211361,211362,211363,211364,211365,211366,211367,211368,211369,211370,211371,211372,211373,211374,211375,212971,212972,194907,194908,194909,194910,194911,194920,194921,194922,194923,194936,194937,194938,194939,194940,194941,194943,194950,194951,194952,194953,194954,194975,194976,194977,194992,194993,194994,194995,194996,194997,202761,195083,195084,195087,195093,195105,195106,195107,195111,195112,195113,195191,195497,195542,195543,195554,195555,195573,195574,195577,195578,195662,195672,196340,196381,196382,196384,196386,196390,196408,196425,196428,196431,196445,196495,196501,196504,196511,196519,196521,196526,196530,196527,196528,196532,196533,196534,196535,196640,196642,196663,196666,196687,196698,196758,196764,196869,196916,196933,196982,196993,196998,196999,197038,197039,197043,197045,197053,197058,197067,197068,197069,197084,197085,197114,197119,197128,197143,197149,197151,197253,197256,197263,197610,197902,197903,197904,197905,198076,198091,198183,198276,198277,198278,198283,198288,198343,198352,198354,200633,201165,201149,201150,201151,201630,201631,201925,201926,201930,201931,202092,202380,202384,202551,202555,202556,202561,202565,202566,202567,202575,202576,202578,202579,202580,202581,202583,202586,202587,202595,202745,202911,203097,203098,211221,211222,211223,211390,211391,211389,211388,216905,216906,216907,216893,216895,216896,216897,216899,216901,216902,216862,216865,216867,216868,216869,216871,216873,216874,216875,216877,216881,216882,216884,216886,216888,216889,216890,216892,216854,216855,216857,216858,216861,211381,212842,212843,212844,212845,213001,213002,213003,213004,213005,203823,204352,212135,212133,212134,212132,212131,212129,212130,212128,212127,212126,212124,212125,212123,212122,212121,212120,212119,212118,212116,212117,212115,212114,212113,212112,212111,212110,212109,212108,212107,212106,212105,212104,212102,212103,212101,212099,212100,212098,212097,212096,212095,212094,212093,212092,212090,212091,212089,212086,212085,212084,212083,212082,212081,212080,212079,212078,212076,212077,212075,212074,212073,212069,212070,212071,212072,212068,212066,212067,212064,212063,212062,212057,212058,212059,212060,212052,212053,212054,212055,212056,212051,212046,212045,212043,212042,212041,212040,212039,212038,212037,212035,212036,212034,212032,212033,212031,212030,212029,212028,212027,212026,212025,212024,212023,212022,212021,212020,212018,212017,212016,212015,212014,212011,212010,212009,212008,212004,212003,211999,212000,211984,211983,211982,211981,211980,211978,211979,211977,211974,211975,211973,211972,211971,211969,211968,211967,211963,211962,211961,211960,211959,211947,211946,211945,211944,211943,211942,211941,211940,211939,211938,211937,211936,211935,211934,211933,211932,211931,211930,211928,211929,211926,211925,211924,211923,211922,211921,211920,211918,211917,211916,211914,211913,211912,211911,211910,211906,211905,211904,211903,211902,211901,211898,211899,211900,211894,211893,211892,211891,211890,211889,211888,211887,211885,211884,211883,211882,211881,211880,211878,211879,211876,211877,211870,211871,211872,211873,211869,211867,211864,211865,211866,211860,211859,211857,211858,211856,211853,211851,211852,211850,211849,211848,211839,211838,211836,211835,211834,211833,211832,211831,211830,211829,211828,211827,211826,211825,211824,211823,211822,211821,211820,211819,211818,211817,211816,211815,211814,211813,211812,211811,211810,211809,211808,211807,211806,211805,211804,211803,211802,211801,211800,211799,211798,211797,211796,211795,211794,211793,211792,211791,211790,211789,211788,211787,211786,211785,211784,211783,211782,211781,211780,211779,211778,211777,211776,211775,211773,211774,211769,211770,211771,211772,211759,211760,211761,211762,211763,211755,211756,211757,211758,211754,211753,211752,211751,211750,211749,211747,211748,211745,211744,211743,211742,211741,211740,211739,211734,211737,211729,211732,211728,211727,211726,211725,211724,211722,211723,211719,211707,211708,211709,211710,211711,211712,211700,211701,211702,211703,211704,211705,211706,211693,211694,211695,211696,211698,211686,211687,211688,211689,211690,211691,211692,211682,211683,211684,211685,211677,211678,211674,211675,211676,211671,211673,211669,211670,211534,211533,211532,211531,211530,211528,211527,211526,211525,211524,211523,211522,211521,211520,211518,211519,211517,211515,211516,211514,211513,211512,211510,211511,211509,211508,211507,211506,211505,211504,211503,211502,211500,211501,211499,211498,211497,211495,211496,211494,211493,211492,211491,211490,211489,211488,211487,211485,211486,211484,211483,211481,211482,211480,211479,211478,211477,211476,211475,211474,211473,211472,211471,211470,211469,211468,211467,211466,211465,211464,211463,211461,211462,211460,211459,211458,211457,211456,211455,211453,211454,211452,211451,211450,211449,211448,211447,211445,211444,211443,211442,211441,211440,211439,211438,211437,211436,211435,211434,211433,211431,211160,211159,211155,211156,211157,211158,211153,211147,211150,211146,211141,211140,211139,211137,211134,211133,211131,211130,211127,211128,211129,211125,211126,211123,211124,211122,211119,211120,211121,211115,211116,211117,211118,211114,211113,211111,211112,211104,211105,211102,211095,211096,211092,211093,211094,211074,211075,211071,211072,211073,211067,211068,211069,211070,211066,211045,211038,211039,211040,211011,210960,210955,210906,210895,210891,210892,210893,210894,210885,210886,210887,210888,210835,210834,210831,210830,210829,210828,210825,210824,210822,210819,210816,210817,210818,210810,210811,210812,210813,210793,210794,210795,210796,210791,210792,210768,210769,210770,210771,210763,210764,210765,210692,210691,210683,210682,210677,210675,210674,210673,210672,210671,210669,210612,210605,210600,210593,210590,210552,210551,210546,210495,210494,210487,210486,210420,210419,210418,210382,210383,210384,210377,210378,210359,210358,210357,210354,210353,210352,210351,210350,210349,210348,210347,210346,210345,210344,210343,210342,210341,210340,210339,210338,210337,210271,210269,210268,210267,210266,210265,210263,210262,210252,210251,210250,225017,225019,225025,225026,225027,225028,226193,225072,225073,225074,225081,226195,226196,226197,234348,226624,226628,226766,226769,226770,226773,226774,226775,226780,226784,226785,226790,226792,226793,226794,226795,226796,226797,226799,226801,226802,226803,226812,226813,226814,226815,226816,226817,226818,226819,226820,226821,226822,226823,226840,226841,226845,227025,227026,227505,227509,227378,227379,227380,227381,227382,227383,227454,227477,227480,227482,227483,227484,227485,227486,227487,227488,227489,227490,227491,227493,227494,227497,227498,227501,227502,227503,227504,227542,227543,227544,227545,227550,227551,227552,227553,227554,227555,227556,227557,227559,227573,227583,227584,227589,227590,227591,227598,227604,227606,227786,227787,227789,227798,227803,227821,227822,227825,227826,227827,227829,228267,228275,228283,228315,228333,228352,228355,228356,228392,228399,228408,228409,228410,228411,228419,228423,228424,228426,228428,228456,228461,228463,228465,228468,228469,228470,228471,228473,228474,228475,228477,228479,228482,228499,228968,228970,228972,229084,229087,229173,229174,229179,229180,229181,229182,229183,229184,229185,229186,229187,229188,229189,229190,229191,229192,229193,229194,229195,229196,229224,229238,229252,229297,229484,229485,229500,229501,229940,229941,229942,230000,230549,230550,230551,230684,230700,230703,230844,230851,230864,230867,230869,230870,230872,230873,230874,230875,230876,230877,230879,230880,230882,230883,230884,230885,230886,230887,230888,230889,230894,230895,230897,230898,230899,230900,230901,230902,230904,230905,230912,230913,230921,230922,230924,230925,230927,230928,230931,230932,230939,230940,230943,230944,230947,230948,230951,230952,230955,230956,230989,230990,230993,230994,230997,230998,231002,231003,231006,231007,231010,231011,231029,231030,231035,231036,231038,231039,231042,231043,231044,231046,231048,231049,231051,231052,231054,231055,231056,231058,231059,231061,231062,231066,231067,231071,231072,231074,231075,231076,231078,231079,231081,231082,231115,231159,231228,231613,233318,233319,234594,234311,234312,234313,234314,234334,234335,234336,234337,234340,234341,234342);


        foreach ( $product_ids as $pid ) {
            echo "$pid<br>\n"; flush();
            $product = new Product();
            $product->get($pid);

            // Check if slug already exists
            $duplicated_slug = new Product();
            $duplicated_slug->get_by_slug( $product->slug );
            // If slug exists, append random number and check again
            while ( $duplicated_slug->id != null ) {
                $product->slug = str_replace( '---', '-', format::slug( $product->name ) ) . '-' . rand( 1000, 9999 );
                $duplicated_slug = new Product();
                $duplicated_slug->get_by_slug( $product->slug );

                unset($duplicated_slug);
            }

            $product->save();

            unset($product);

        }
    }

    public function yext_sync_products() {
        $account = new Account();
        $account->get(1352);

        $location = new WebsiteYextLocation();
        $location->get( 4, 1352 );

        if ( $location->synchronize_products ) {
            $location->do_synchronize_products( $location );
        }

    }

    public function yext_upload_photos() {
        $account = new Account();
        $account->get(1352);

        $location = new WebsiteYextLocation();
        $location->get( 9, 1352 );

        if ( $location->synchronize_products ) {
            $location->do_upload_photos( $location );
        }

    }


    /**
     * Add same child element as parent if dropdown in navigation
     * @return HtmlResponse
     */
    public function update_navigation() {
        $account = new Account();

        $websites = $account->get_results(
            "SELECT w.`website_id`, ws.`value` as navigation FROM `websites` AS w LEFT JOIN `website_settings` AS ws ON ( ws.`website_id` = w.`website_id` )  WHERE ws.`key` = 'navigation' AND ws.`value` <> '' ORDER BY w.`title`"
        );

        foreach($websites as $website){
            $urls = json_decode($website->navigation, true);

            $flag = false;

            foreach($urls as $index=>$url){
                if(isset($url['children'])){
                    $flag=true;
                    array_unshift($urls[$index]['children'], array('url'=>$url['url'], 'name'=>$url['name']));
                }
            }

            if($flag){
                // How many settings are we dealing with?
                $settings_count = 1;

                // Get the setting values
                $setting_values = array();
                $setting_values[] = $website->website_id;
                $setting_values[] = strip_tags('navigation');
                $setting_values[] = strip_tags( json_encode($urls), '<p><font><ul><li><a>' );

                // Insert it or update it
                $account->prepare(
                    'INSERT INTO `website_settings` ( `website_id`, `key`, `value` ) VALUES ' . substr( str_repeat( ', ( ?, ?, ? )', $settings_count ), 2 ) . ' ON DUPLICATE KEY UPDATE `value` = VALUES( `value` )'
                    , str_repeat( 'iss', $settings_count )
                    , $setting_values
                )->query();
            }
        }

        return new HtmlResponse( 'success' );
    }

    /**
     * Updates product to be used for image for category based on the image URL
     * @return HtmlResponse
     */
    public function update_category_product() {
        set_time_limit(15000);

        $category = new AccountCategory();

        $dt = new DataTableResponse( $this->user );

        $dt->add_where( ' AND wc.`product_id` = 0  AND wc.`image_url` <> ""' );
        $total = $category->count_all($dt->get_variables());

        while($total > 0){
            $categories = $category->list_all($dt->get_variables());

            foreach($categories as $cat){
                $parts = (explode('/', str_replace('/products/', '', substr($cat->image_url, strpos($cat->image_url, '/products/')))));
                $cat->get( $cat->website_id, $cat->category_id );
                $cat->product_id = $parts[0];
                $cat->save();
            }

            $total = $category->count_all($dt->get_variables());
        }

        return new HtmlResponse( 'success' );
    }

    /**
     * Updates image of category where the product got deleted or discontinued or blocked
     * @return HtmlResponse
     */
    public function update_category_image_if_stale(){
        set_time_limit(15000);

        $account_category = new AccountCategory();
        $categories = $account_category->get_all_with_stale_images();

        foreach ($categories as $category){
            $account_category->reassign_image( $category['website_id'], $category['product_id'] );
        }

        return new HtmlResponse( 'success' );
    }

}