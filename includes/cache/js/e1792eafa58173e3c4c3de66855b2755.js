
var mammoth=function(a){var b=$("textarea[rte]",a);b.length&&head.js("/ckeditor/ckeditor.js","/ckeditor/adapters/jquery.js",function(){b.ckeditor({autoGrow_minHeight:100,resize_minHeight:100,height:100,toolbar:[["Bold","Italic","Underline"],["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"],["NumberedList","BulletedList","Table"],["Format"],["Link","Unlink"],["Source"]]})});var c=$("form[ajax]",a);c.length&&head.js("/js2/?f=jquery.form",function(){c.ajaxForm({dataType:"json",success:ajaxResponse})})};head.ready(function(){mammoth($("body"))});head.js('http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/jquery-ui.min.js','/js2/?f=jquery.boxy',function(){var cache={sku:{},product:{},brand:{}};$('#sAutoComplete').change(function(){var tAutoComplete=$('#tAutoComplete');tAutoComplete.attr('tmpval',tAutoComplete.attr('tmpval').replace(/\s([\w\s]+).../,' '+$(this).find('option:selected').text()+'...')).val('').blur();});$('#tAutoComplete').autocomplete({minLength:1,source:function(request,response){var cacheType=$('#sAutoComplete').val();if(request['term']in cache[cacheType]){response($.map(cache[cacheType][request['term']],function(item){return{'label':item['name'],'value':item['name']}}));return;}
$.post('/ajax/products/autocomplete/',{'_nonce':$('#_ajax_autocomplete').val(),'type':cacheType,'term':request['term'],'owned':1},function(autocompleteResponse){cache[cacheType][request['term']]=autocompleteResponse['suggestions'];response($.map(autocompleteResponse['suggestions'],function(item){return{'label':item['name'],'value':item['name']}}));},'json');}});$('#aSearch').click(loadProducts);$("#dProductList").sortable({items:'.product',update:function(){$.post('/ajax/products/update-website-product-sequence/',{_nonce:$('#_ajax_update_website_product_sequence').val(),s:$('#dProductList').sortable('serialize'),p:$('#hCurrentPage').val(),pp:$('#hPerPage').val()},ajaxResponse,'json');},scroll:true,placeholder:'product-placeholder'});$('.edit-product').live('click',function(){var productID=$(this).parent().attr('id').replace('pProductAction','');$('#aPricingProductInformation').click();$('#dEditProduct .screen-selector').removeClass('selected');$('#aPricingProductInformation').addClass('selected');$('#dEditProduct .screen').hide().removeClass('selected');$('#dPricingProductInformation').show().addClass('selected');$.post('/ajax/products/get-product-dialog-info/',{_nonce:$('#_ajax_get_product_dialog_info').val(),pid:productID},function(response){var p=response['product'];var product_options=response['product_options'];$('#hProductID').val(p['product_id']);$('#tAlternatePrice').val(p['alternate_price']);$('#tAlternatePriceName').val(p['alternate_price_name']);$('#tPrice').val(p['price']);$('#tSalePrice').val(p['sale_price']);$('#cbOnSale').attr('checked',1==p['on_sale']);$('#tPriceNote').val(p['price_note']);$('#taProductNote').val(p['product_note']);$('#tWarrantyLength').val(p['warranty_length']);$('#tWarrantyLength').val(p['warranty_length']);$('#tInventory').val(p['inventory']);$('#cbDisplayInventory').attr('checked',1==p['display_inventory']);$('#sStatus option[value='+((0==p['status'])?0:1)+']').attr('selected',true);$('#tMetaTitle').val(p['meta_title']);$('#tMetaDescription').val(p['meta_description']);$('#tMetaKeywords').val(p['meta_keywords']);new Boxy($('#dEditProduct'),{width:760,height:$('#dDialogHeight').val(),title:'Edit Product'});var newOptions='<option value="">-- Select a Product Option --</option>',newDivs='',divContent='';for(var i in product_options){newOptions+='<option value="'+i+'">'+product_options[i]['option_name']+'</option>';divContent='';if(product_options[i]['option_type']=='select'){divContent+='<div class="row"><div class="cell left">Option</div><div class="cell">Price (Optional)</div></div>';for(var j in product_options[i]['list_items']){divContent+='<div class="row"><div class="cell left"><input type="checkbox" class="list-item-cb cb cb-option-'+i+'" id="cbOption_'+i+'_'+j+'" name="product_list_items['+i+']['+j+']" value="true" /> '+product_options[i]['list_items'][j]+'</div><div class="cell"><input type="text" class="tb highlight-price" id="tPrice_'+i+'_'+j+'" name="tPrices['+i+']['+j+']" maxlength="10" disabled="disabled" /></div></div>';}
divContent+='<div class="row"><div class="cell left"><input type="checkbox" class="cb" name="cbRequired'+i+'" id="cbRequired'+i+'" value="true" /> <strong>Required option?</strong></div></div>';}else{divContent+='<span class="price">Price:</span> <input type="text" class="tb highlight-price" id="tPrice'+i+'" name="tPrice'+i+'" maxlength="10" />';}
newDivs+='<div class="row hidden" id="dProductOptionRow'+i+'"><div class="cell left product-option-name"><strong>'+product_options[i]['option_name']+'</strong><a href="javascript:;" class="delete-product-option" id="aDeleteProductOption'+i+'" title="Delete Product Option"><img src="/images/icons/x.png" width="15" height="17" alt="Delete Product Option" /></a></div><div class="cell right">'+divContent+'</div></div>';}
$('#sProductOptions').html(newOptions);$('#dProductOptionsList').html(newDivs);if(p['product_options'])
for(var i in p['product_options']){var option=$('#sProductOptions option[value='+i+']'),po_name=option.text();if(''==po_name)
continue;var product_row=$('#dProductOptionRow'+i),product_row_div=product_row.clone();product_row.remove();$('#dProductOptionsList').append(product_row_div).append('<input type="hidden" name="product_options['+i+']" id="hProductOption'+i+'" value="'+i+'" />');$('#dProductOptionRow'+i).slideDown();$('#cbRequired'+i).attr('checked',(1==p['product_options'][i]['required'])?true:false);option.attr('disabled',true);var input_price=$('#tPrice'+i);if(typeof(input_price.attr('id'))!='undefined')
input_price.val(p['product_options'][i]['price']);if(typeof(p['product_options'][i]['list_items'])!='undefined')
for(var j in p['product_options'][i]['list_items']){$('#cbOption_'+i+'_'+j).attr('checked',true);$('#tPrice_'+i+'_'+j).val(p['product_options'][i]['list_items'][j]).attr('disabled',false);}}
$('.highlight-price').each(function(){$(this).css('color',((-1!=$(this).val().search(/^-/))?'#CC2222':''));});$('#tStoreSKU').val(p['store_sku']);$('#tShipsIn').val(p['ships_in']);var shipping_type=('Flat Rate'==p['additional_shipping_type'])?'FlatRate':'Percentage';$('#rShippingMethod'+shipping_type).attr('checked',true);$('#tShipping'+shipping_type).val(p['additional_shipping_amount']).css('visibility','visible');$('#tShipping'+('FlatRate'==shipping_type)?'Percentage':'FlatRate').val('').css('visibility','hidden');var protection_type=('Flat Rate'==p['protection_type'])?'FlatRate':'Percentage';$('#rProtectionMethod'+protection_type).attr('checked',true);$('#tProtection'+protection_type).val(p['protection_amount']).css('visibility','visible');$('#tProtection'+('FlatRate'==protection_type)?'Percentage':'FlatRate').val('').css('visibility','hidden');$('#tWholesalePrice').val(p['wholesale_price']);$('#tWeight').val(p['weight']);var coupon_list=$('#dCouponList'),coupons=$('#sCoupons'),coupon_divs='';coupon_list.empty();coupons.find('option').attr('disabled',false);coupons.attr('selectedIndex',0);for(var i in p['coupons']){coupon_divs+='<div id="dCoupon'+i+'" class="coupon"><span class="coupon-name">'+p['coupons'][i]+'</span><div style="display:inline;float:right"><a href="javascript:;" class="delete-coupon" title=\'Delete "'+p['coupons'][i]+'" List Item\' id="aDeleteCoupon'+i+'"><img src="/media/images/icons/x.png" /></a></div></div>';coupons.find('option[value='+i+']').attr('disabled',true);}
coupon_list.append(coupon_divs);updateCoupons();},'json');});$('#dEditProduct .rb-shipping').change(function(){if($(this).attr('checked')){var value=$(this).val();$('.additional-shipping.selected:first').css('visibility','hidden').removeClass('selected');switch(value){case'Flat Rate':$('#tShippingFlatRate').parent().css('visibility','visible').addClass('selected');break;case'Percentage':$('#tShippingPercentage').parent().css('visibility','visible').addClass('selected');break;default:break;}}});$('#dEditProduct .rb-protection').change(function(){if($(this).attr('checked')){var value=$(this).val();$('.protection.selected:first').css('visibility','hidden').removeClass('selected');switch(value){case'Flat Rate':$('#tProtectionFlatRate').parent().css('visibility','visible').addClass('selected');break;case'Percentage':$('#tProtectionPercentage').parent().css('visibility','visible').addClass('selected');break;default:break;}}});$('#dEditProduct .screen-selector').click(function(){if($(this).hasClass('selected'))
return;var screen_selector=$(this).attr('id').replace(/^a/,'');$('#dEditProduct .screen-selector').removeClass('selected');$(this).addClass('selected');$('#dEditProduct .screen.selected:first').fadeOut('fast').removeClass('selected');setTimeout(function(){$('#d'+screen_selector).fadeIn().addClass('selected');},250);});$('#aAddCoupon').click(function(){var option=$('#sCoupons option:selected'),couponID=option.val(),couponName=option.text();if(''==couponID)
return;$('#dCouponList').append('<div id="dCoupon'+couponID+'" class="coupon"><span class="coupon-name">'+couponName+'</span><div style="display:inline;float:right"><a href="javascript:;" class="delete-coupon" title="Delete Coupon" id="aDeleteCoupon'+couponID+'"><img src="/images/icons/x.png" /></a></div></div>');$('#sCoupons').attr('selectedIndex',0);option.attr('disabled',true);updateCoupons();});$('.delete-coupon').live('click',function(){var couponID=$(this).attr('id').replace('aDeleteCoupon','');if(confirm('Are you sure you want to delete this coupon?')){$('#dCoupon'+couponID).remove();$('#sCoupons option[value='+couponID+']').attr('disabled',false);updateCoupons();}});$('#aAddProductOption').click(function(){var option=$('#sProductOptions option:selected'),po_id=option.val(),po_name=option.text();if(''==po_id)
return;var product_row=$('#dProductOptionRow'+po_id),product_row_div=product_row.clone();product_row.remove();$('#dProductOptionsList').append(product_row_div).append('<input type="hidden" name="product_options['+po_id+']" id="hProductOption'+po_id+'" value="'+po_id+'" />');$('#dProductOptionRow'+po_id).slideDown();$('#sProductOptions').attr('selectedIndex',0);option.attr('disabled',true);});$('.delete-product-option').live('click',function(){var po_id=$(this).attr('id').replace('aDeleteProductOption','');if(confirm('Are you sure you want to delete this product_option?')){$('#dProductOptionRow'+po_id).hide();$('#sProductOptions option[value='+po_id+']').attr('disabled',false);$('#hProductOption'+po_id).remove();}});$('#dEditProduct .list-item-cb').live('click',function(){$('#tPrice'+$(this).attr('id').replace('cbOption','')).attr('disabled',!$(this).attr('checked'));});$('.highlight-price').live('keyup',function(){$(this).css('color',((-1!=$(this).val().search(/^-/))?'#CC2222':''));});var dialog_height=$('#dDialogHeight').val();if(500==dialog_height)
$('.screen').css('height','340px');});$.fn.lowerProductCount=function(){var dProductCount=$('#dProductCount'),productCountText=dProductCount.text(),productCount=productCountText.replace(/[^0-9]+([0-9]+).+/,'$1');dProductCount.text(productCountText.replace(/([0-9]+)\//,productCount-1+'/'));}
function updateCoupons(){var couponIDs='';$('#dCouponList .coupon').each(function(){if(couponIDs.length)
couponIDs+='|';couponIDs+=$(this).attr('id').replace('dCoupon','');});$('#hCoupons').val(couponIDs);}
function loadProducts(){var categoryID=$('#sCategory').val(),tAutoComplete=$('#tAutoComplete'),autoComplete=tAutoComplete.val(),hCurrentPage=$("#hCurrentPage"),sProductsPerPage=$('#sProductsPerPage'),itemsPerPage=parseInt((sProductsPerPage.length)?sProductsPerPage.val():20);if(parseInt($("#doNotRefresh").val())>0)
var currentPage=(!(hCurrentPage.val()))?1:hCurrentPage.val();if(!currentPage)
currentPage=1;if(categoryID.length&&!autoComplete.length||autoComplete==tAutoComplete.attr('tmpval')){$("#dProductList").sortable('enable');}else{$("#dProductList").sortable('disable');}
$.post('/ajax/products/get-products/',{_nonce:$('#_ajax_get_products').val(),cid:categoryID,s:$('#sAutoComplete').val(),v:autoComplete,n:itemsPerPage,p:currentPage},function(html){$('#dProductList').html(html).sparrow();adjustImageSizes();$('#sProductsPerPage').val(itemsPerPage);$("#sProductsPerPage").change(loadProducts);$("#tListRequests_previous").click(previousPage);$("#tListRequests_next").click(nextPage);},'html');}
function previousPage(){var hCurrentPage=$("#hCurrentPage"),currentPage=parseInt(hCurrentPage.val());if(currentPage>1){hCurrentPage.val(currentPage-1);$("#doNotRefresh").val('1');loadProducts();}}
function nextPage(){var hCurrentPage=$("#hCurrentPage"),currentPage=parseInt(hCurrentPage.val()),itemsPerPage=$('#sProductsPerPage').val();if(currentPage*itemsPerPage<parseInt($("#hWebsiteProductsCount").val())){hCurrentPage.val(currentPage+1);$("#doNotRefresh").val('1');loadProducts();}}
function adjustImageSizes(){var productImages=$('#dProductList img.product-image'),productImagesLength=productImages.length,totalImages=0;productImages.each(function(){$(this).load(function(){var height=$(this).height(),width=$(this).width(),newWidth=150,newHeight=Math.round((height*newWidth)/width);if(newHeight>100){newHeight=100;newWidth=Math.round((width*newHeight)/height);}
$('#sLoadingMsg'+$(this).attr('id').replace('pImage','')).hide();$(this).width(newWidth).height(newHeight).show();totalImages++;if(totalImages==productImagesLength)
adjustProductBoxesHeight();});});}
function adjustProductBoxesHeight(){var maxHeight=0;$('#dProductList div.product').each(function(){newHeight=$(this).height();maxHeight=(maxHeight<newHeight)?newHeight:maxHeight;}).height(maxHeight);}var sparrow=function(a){$("input[tmpval],textarea[tmpval]",a).each(function(){$(this).focus(function(){$(this).val()==$(this).attr("tmpval")&&$(this).val("").removeClass("tmpval")}).blur(function(){var b=$(this).val(),a=$(this).attr("tmpval");(0==b.length||b==a)&&$(this).val(a).addClass("tmpval")});$(this).val().length||$(this).val($(this).attr("tmpval")).addClass("tmpval")});var e=$("table[ajax],table.dt",a);e.length&&head.js("/js2/?f=jquery.datatables",function(){e.addClass("dt").each(function(){var b=$(this).attr("perPage").split(","),a="",d=$(this).find("th").append('<img src="/images/trans.gif" width="10" height="8" />'),g=[],h=[],i="",e="",f=$(this).attr("ajax"),c;for(c in b)a+='<option value="'+b[c]+'">'+b[c]+"</option>";if(d.length)for(c=0;c<d.length;c++){if(i=$(d[c]).attr("sort")){var j=-1==i.search("desc")?"asc":"desc";g[i.replace(" desc","")-1]=[c,j]}(e=$(d[c]).attr("column"))?h.push({sType:e}):h.push(null)}else g=[[0,"asc"]];b={bAutoWidth:!1,iDisplayLength:parseInt(b[0]),oLanguage:{sLengthMenu:"Rows: <select>"+a+"</select>",sInfo:"_START_ - _END_ of _TOTAL_"},aaSorting:g,aoColumns:h,fnDrawCallback:function(){sparrow($(this).find("tr:last").addClass("last").end())},sDom:'<"top"Tlfr>t<"bottom"pi>'};if(f)b.bProcessing=1,b.bServerSide=1,b.sAjaxSource=f;$(this).dataTable(b)})});var f=$("a[rel=dialog]",a);f.length&&head.js("/js2/?f=jquery.boxy",function(){f.click(function(b){b.preventDefault();var b=$(this).attr("href").split("#"),a=$("#"+b[1]),d={title:$(this).attr("title"),behaviours:sparrow};a.length&&"0"!=$(this).attr("cache")?new Boxy(a,d):($("body").append('<div id="'+b[1]+'" class="dialog" />'),a=$("#"+b[1]),a.load(b[0],function(){new Boxy(a,d)}))})});$("a[ajax]",a).click(function(a){a.preventDefault();a=$(this).attr("confirm");(!a||confirm(a))&&$.get($(this).attr("href"),ajaxResponse,"json")}).removeAttr("ajax");"function"==typeof mammoth&&mammoth(a)};$.fn.sparrow=sparrow;head.ready(function(){sparrow($("body"))});function ajaxResponse(a){a.success?a.refresh?window.location=window.location:"object"==typeof a.jquery&&head.js("/js2/?f=jquery.php",function(){php(a.jquery)}):a.error&&alert(a.error)};jQuery(function(){$("#aTicket").click(function(){var a=$(this);a.hasClass("loaded")?new Boxy($("#dTicketPopup"),{title:a.attr("title")}):head.js("/js2/?f=jquery.boxy","/js2/?f=jquery.form","/js2/?f=swfobject","/js2/?f=jquery.uploadify",function(){a.addClass("loaded");new Boxy($("#dTicketPopup"),{title:a.attr("title")});$("#fCreateTicket").addClass("ajax").ajaxForm({dataType:"json",beforeSubmit:function(){var a=$("#tTicketSummary"),d=a.val(),b=$("#taTicket"),c=b.val();if(!d.length||d==a.attr("tmpval"))return alert(a.attr("error")),!1;return!c.length||c==b.attr("tmpval")?(alert(b.attr("error")),!1):!0},success:ajaxResponse});$("#fTicketUpload").uploadify({auto:!0,multi:!0,displayData:"speed",buttonImg:"/images/buttons/add-attachment.png",cancelImg:"/images/icons/x.png",fileExt:"*.pdf;*.mov;*.wmv;*.flv;*.swf;*.f4v;*.mp4;*.avi;*.mp3;*.aif;*.wma;*.wav;*.csv;*.doc;*.docx;*.rtf;*.xls;*.xlsx;*.wpd;*.txt;*.wps;*.pps;*.ppt;*.wks;*.bmp;*.gif;*.jpg;*.jpeg;*.png;*.psd;*.eps;*.tif;*.zip;*.7z;*.rar;*.zipx;*.aiff;*.odt;",fileDesc:"Valid File Formats",onComplete:function(a,d,b,c){ajaxResponse($.parseJSON(c))},onSelect:function(){$("#fTicketUpload").uploadifySettings("scriptData",{_nonce:$("#_ajax_ticket_upload").val(),uid:$("#hUserID").val(),wid:$("#hTicketWebsiteID").val(),tid:$("#hTicketID").val()});return!0},sizeLimit:6291456,script:"/ajax/support/ticket-upload/",uploader:"/media/flash/uploadify.swf",width:124,height:34})})})});